<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Delhi Monopoly</title>
<script src="/socket.io/socket.io.js"></script>

<style>
body{font-family:Arial;background:#f2f2f2;margin:0;padding:10px}
#board{display:grid;grid-template-columns:repeat(4,1fr);gap:8px}
.tile{background:#fff;border-radius:8px;padding:6px;min-height:80px;position:relative}
.color{height:6px;border-radius:6px 6px 0 0}
.brown{background:#8b5a2b}
.lightblue{background:#6ec6ff}
.pink{background:#ff80ab}
.orange{background:#ffb74d}
.red{background:#e57373}
.yellow{background:#fff176}
.green{background:#81c784}

.owner{font-size:10px;color:#333;margin-top:4px}
.token{position:absolute;bottom:4px;right:6px;font-weight:bold}
button{padding:6px;margin:4px}
#players{margin-top:10px}
.popup{position:fixed;top:20%;left:10%;right:10%;background:#fff;border:2px solid #333;padding:10px;display:none}
.close{float:right;cursor:pointer;font-weight:bold}
</style>
</head>

<body>

<h2>Delhi Monopoly</h2>

<input id="playerName" placeholder="Name">
<button onclick="join()">Join</button>
<button onclick="roll()">ðŸŽ² Roll</button>

<div id="log"></div>

<div id="board"></div>

<div id="players"></div>

<button onclick="showPopup('chancePopup')">Chance</button>
<button onclick="showPopup('communityPopup')">Community</button>

<div id="chancePopup" class="popup">
<span class="close" onclick="hide('chancePopup')">X</span>
<h3>Chance Cards</h3>
<ul>
<li>Advance to GO</li>
<li>Pay â‚¹50</li>
<li>Collect â‚¹100</li>
<li>Go to Jail</li>
</ul>
</div>

<div id="communityPopup" class="popup">
<span class="close" onclick="hide('communityPopup')">X</span>
<h3>Community Cards</h3>
<ul>
<li>Doctor fee â‚¹50</li>
<li>School fee â‚¹100</li>
<li>Collect â‚¹200</li>
</ul>
</div>

<script>
const socket = io();
let myId = null;

function join(){
  const name = document.getElementById("playerName").value.trim();
  if(!name) return alert("Enter name");
  socket.emit("join", name);
}

function roll(){
  socket.emit("roll");
}

socket.on("state", data=>{
  myId = socket.id;
  renderBoard(data.board, data.players);
  renderPlayers(data.players);
});

socket.on("rolled", d=>{
  document.getElementById("log").innerText =
    `${d.name} rolled ${d.dice} â†’ ${d.tile}`;
});

function renderBoard(board, players){
  const b = document.getElementById("board");
  b.innerHTML = "";
  board.forEach((t,i)=>{
    const div = document.createElement("div");
    div.className="tile";
    if(t.color){
      const c=document.createElement("div");
      c.className="color "+t.color;
      div.appendChild(c);
    }
    div.innerHTML += `<b>${t.name}</b>`;
    if(t.price) div.innerHTML += `<br>â‚¹${t.price}`;

    if(t.owner){
      div.innerHTML += `<div class="owner">Owned</div>`;
    }

    if(!t.owner && t.price){
      const btn=document.createElement("button");
      btn.innerText="Buy";
      btn.onclick=()=>socket.emit("buy", i);
      div.appendChild(btn);
    }

    Object.values(players).forEach(p=>{
      if(p.pos===i){
        const tok=document.createElement("div");
        tok.className="token";
        tok.innerText=p.name[0];
        div.appendChild(tok);
      }
    });

    b.appendChild(div);
  });
}

function renderPlayers(players){
  const p=document.getElementById("players");
  p.innerHTML="";
  Object.values(players).forEach(pl=>{
    p.innerHTML += `<div>${pl.name}: â‚¹${pl.money}</div>`;
  });
}

function showPopup(id){document.getElementById(id).style.display="block"}
function hide(id){document.getElementById(id).style.display="none"}
</script>

</body>
</html>
