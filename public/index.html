<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Delhi Monopoly</title>
<script src="/socket.io/socket.io.js"></script>

<style>
body{
  font-family:Arial;
  background:#f2f2f2;
  margin:0;
  padding:10px;
}

#controls{text-align:center;margin-bottom:10px}
button{padding:6px 12px;margin:4px}

#message{text-align:center;font-weight:bold;margin-bottom:8px}

#board{
  display:grid;
  grid-template-columns:repeat(4,1fr);
  gap:8px;
}

.tile{
  background:#fff;
  border-radius:10px;
  min-height:95px;
  padding:6px;
  position:relative;
  font-size:13px;
}

.strip{
  height:6px;
  border-radius:6px 6px 0 0;
  margin:-6px -6px 4px -6px;
}

.brown{background:#8d6e63}
.lightblue{background:#81d4fa}
.pink{background:#f48fb1}
.orange{background:#ffb74d}
.red{background:#e57373}
.yellow{background:#fff176}
.green{background:#81c784}
.blue{background:#64b5f6}

.owned-me{border:3px solid #2ecc71}
.owned-other{border:3px solid #e74c3c}

.token{
  position:absolute;
  bottom:4px;
  right:4px;
  font-size:12px;
  background:#000;
  color:#fff;
  padding:2px 6px;
  border-radius:12px;
}

#players{
  margin-top:10px;
}

.playerBox{
  background:#fff;
  border-radius:8px;
  padding:6px;
  margin-bottom:6px;
}

.you{color:#0077ff;font-weight:bold}

/* POPUPS */
.overlay{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.5);
  display:none;
}

.popup{
  background:#fafafa;
  border:2px solid #333;
  padding:15px;
  border-radius:8px;
  width:85%;
  margin:25% auto;
}

.close{float:right;cursor:pointer;font-weight:bold}
</style>
</head>

<body>

<h2>Delhi Monopoly</h2>

<div id="controls">
  <input id="name" placeholder="Name">
  <button onclick="join()">Join</button>
  <button onclick="roll()">üé≤ Roll</button>
</div>

<div id="message"></div>

<div id="board"></div>

<div id="players"></div>

<!-- Bottom info buttons -->
<div style="text-align:center;margin-top:10px">
  <button onclick="showChanceInfo()">Chance</button>
  <button onclick="showCommunityInfo()">Community</button>
</div>

<!-- Info popup -->
<div id="infoOverlay" class="overlay">
  <div class="popup">
    <span class="close" onclick="closeInfo()">‚úñ</span>
    <div id="infoText"></div>
  </div>
</div>

<!-- Card popup -->
<div id="cardOverlay" class="overlay">
  <div class="popup">
    <b id="cardTitle"></b><br><br>
    <div id="cardText"></div><br>
    <button onclick="closeCard()">OK</button>
  </div>
</div>

<script>
const socket = io();
let myId = null;

function join(){
  socket.emit("join", name.value);
}

function roll(){
  socket.emit("roll");
}

function closeCard(){
  socket.emit("closeCard");
}

function showChanceInfo(){
  infoText.innerHTML = `
  <b>Chance Cards</b><br>
  ‚Ä¢ Advance to GO<br>
  ‚Ä¢ Go to Jail<br>
  ‚Ä¢ Receive / Pay money<br>
  ‚Ä¢ Move across board`;
  infoOverlay.style.display="block";
}

function showCommunityInfo(){
  infoText.innerHTML = `
  <b>Community Chest</b><br>
  ‚Ä¢ Bank rewards<br>
  ‚Ä¢ Fees & fines<br>
  ‚Ä¢ Go to Jail<br>
  ‚Ä¢ Player payments`;
  infoOverlay.style.display="block";
}

function closeInfo(){
  infoOverlay.style.display="none";
}

socket.on("update", g=>{
  message.innerText = g.message || "";

  board.innerHTML="";
  g.board.forEach(t=>{
    let cls="tile";
    if(t.owner){
      cls += (t.owner===myId) ? " owned-me" : " owned-other";
    }
    board.innerHTML += `
      <div class="${cls}">
        ${t.color ? `<div class="strip ${t.color}"></div>`:""}
        <b>${t.name}</b>
      </div>`;
  });

  players.innerHTML="";
  g.players.forEach(p=>{
    if(!myId && p.id) myId = socket.id;
    players.innerHTML += `
      <div class="playerBox">
        <span class="${p.id===socket.id?'you':''}">
          ${p.name} ${p.id===socket.id?'(YOU)':''}
        </span><br>
        üí∞ ‚Çπ${p.money} | üìç ${p.position}
      </div>`;
  });

  if(g.cardPopup){
    cardTitle.innerText = g.cardPopup.title;
    cardText.innerText = g.cardPopup.text;
    cardOverlay.style.display="block";
  }else{
    cardOverlay.style.display="none";
  }
});
</script>

</body>
</html>
