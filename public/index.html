<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Delhi Monopoly</title>
<script src="/socket.io/socket.io.js"></script>

<style>
body{font-family:Arial;background:#f2f2f2;padding:10px}
#controls{text-align:center;margin-bottom:10px}
button{padding:6px 12px;margin:4px}

#board{display:grid;grid-template-columns:repeat(4,1fr);gap:8px}
.tile{background:#fff;border-radius:10px;min-height:95px;padding:6px;position:relative}

.strip{height:6px;border-radius:6px 6px 0 0;margin:-6px -6px 4px -6px}
.brown{background:#8d6e63}
.lightblue{background:#81d4fa}
.pink{background:#f48fb1}
.orange{background:#ffb74d}
.red{background:#e57373}
.yellow{background:#fff176}
.green{background:#81c784}
.blue{background:#64b5f6}

.owned-me{border:3px solid #2ecc71}
.owned-other{border:3px solid #e74c3c}

.token{
  position:absolute;
  bottom:4px;
  right:4px;
  background:#000;
  color:#fff;
  padding:2px 6px;
  border-radius:12px;
  font-size:12px;
}

.playerBox{background:#fff;border-radius:8px;padding:6px;margin-top:6px}
.you{color:#0077ff;font-weight:bold}

.overlay{position:fixed;inset:0;background:rgba(0,0,0,.5);display:none}
.popup{background:#fafafa;border:2px solid #333;padding:15px;border-radius:8px;width:85%;margin:25% auto}
</style>
</head>

<body>

<h2>Delhi Monopoly</h2>

<div id="controls">
  <input id="name" placeholder="Name">
  <button onclick="join()">Join</button>
  <button onclick="roll()">üé≤ Roll</button>
</div>

<div id="message"></div>
<div id="board"></div>
<div id="buyArea" style="text-align:center;margin-top:8px"></div>
<div id="players"></div>

<div id="cardOverlay" class="overlay">
  <div class="popup">
    <b id="cardTitle"></b><br><br>
    <div id="cardText"></div><br>
    <button onclick="closeCard()">OK</button>
  </div>
</div>

<script>
const socket = io();

function join(){
  if(!name.value.trim()){ alert("Enter name"); return; }
  socket.emit("join", name.value.trim());
}

function roll(){ socket.emit("roll"); }
function buy(){ socket.emit("buy"); }
function closeCard(){ socket.emit("closeCard"); }

socket.on("update", g=>{
  message.innerText = g.message || "";
  board.innerHTML="";
  buyArea.innerHTML="";

  g.board.forEach((t,i)=>{
    const here = g.players.filter(p=>p.position===i);
    const tokens = here.map(p=>`<span class="token">${p.name[0]}</span>`).join("");

    let cls="tile";
    if(t.owner){
      cls += (t.owner===socket.id) ? " owned-me" : " owned-other";
    }

    board.innerHTML += `
      <div class="${cls}">
        ${t.color?`<div class="strip ${t.color}"></div>`:""}
        <b>${t.name}</b>
        ${tokens}
      </div>`;
  });

  if(g.awaitingBuy && g.awaitingBuy.playerId===socket.id){
    const tile = g.board[g.awaitingBuy.tileIndex];
    buyArea.innerHTML = `<button onclick="buy()">Buy ${tile.name} (‚Çπ${tile.price})</button>`;
  }

  players.innerHTML="";
  g.players.forEach(p=>{
    players.innerHTML += `
      <div class="playerBox">
        <span class="${p.id===socket.id?'you':''}">
          ${p.name} ${p.id===socket.id?'(YOU)':''}
        </span><br>
        üí∞ ‚Çπ${p.money} | üìç ${p.position+1}
      </div>`;
  });

  if(g.cardPopup){
    cardTitle.innerText = g.cardPopup.title;
    cardText.innerText = g.cardPopup.text;
    cardOverlay.style.display="block";
  }else{
    cardOverlay.style.display="none";
  }
});
</script>

</body>
</html>
