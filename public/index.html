<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Delhi Monopoly</title>
<script src="/socket.io/socket.io.js"></script>

<style>
body{font-family:Arial;background:#f2f2f2;padding:10px}
#controls{text-align:center;margin-bottom:10px}
button{padding:6px 12px;margin:4px}

#board{display:grid;grid-template-columns:repeat(4,1fr);gap:8px}

.tile{
  background:#fff;
  border-radius:10px;
  padding:6px;
  min-height:95px;
  position:relative;
  font-size:13px;
}

.strip{
  height:6px;
  border-radius:6px 6px 0 0;
  margin:-6px -6px 4px -6px;
}

.brown{background:#8b4513}
.lightblue{background:#87ceeb}
.pink{background:#ff69b4}
.orange{background:#ffa500}
.red{background:#e74c3c}
.yellow{background:#f1c40f}
.green{background:#2ecc71}
.blue{background:#3498db}

.owned-me{border:3px solid #2ecc71}
.owned-other{border:3px solid #e74c3c}

/* NICE TOKENS */
.token{
  width:18px;
  height:18px;
  border-radius:50%;
  background:#000;
  color:#fff;
  font-size:12px;
  display:flex;
  align-items:center;
  justify-content:center;
  position:absolute;
  bottom:4px;
  right:4px;
  font-weight:bold;
}

#players{margin-top:10px}
.playerBox{
  background:#fff;
  padding:6px;
  border-radius:6px;
  margin-bottom:6px;
}
.you{font-weight:bold;color:#2980b9}
</style>
</head>

<body>

<h2>Delhi Monopoly</h2>

<div id="controls">
  <input id="playerName" placeholder="Your name">
  <button onclick="join()">Join</button>
  <button onclick="roll()">üé≤ Roll</button>
</div>

<div id="message"></div>
<div id="board"></div>
<div id="buyArea" style="text-align:center;margin-top:8px"></div>
<div id="players"></div>

<script>
const socket = io();

function join(){
  const name = document.getElementById("playerName").value.trim();
  if(!name){ alert("Enter name"); return; }
  socket.emit("join", name);
}

function roll(){
  socket.emit("roll");
}

function buy(){
  socket.emit("buy");
}

socket.on("state", state => {
  document.getElementById("message").innerText = state.message || "";

  const boardDiv = document.getElementById("board");
  const buyArea = document.getElementById("buyArea");
  const playersDiv = document.getElementById("players");

  boardDiv.innerHTML = "";
  buyArea.innerHTML = "";

  state.board.forEach((t,i)=>{
    const div = document.createElement("div");
    div.className = "tile";

    if(t.color){
      const strip = document.createElement("div");
      strip.className = "strip " + t.color;
      div.appendChild(strip);
    }

    div.innerHTML += `<b>${t.name}</b>`;
    if(t.price) div.innerHTML += `<br>‚Çπ${t.price}`;

    if(t.owner){
      div.classList.add(
        t.owner === socket.id ? "owned-me" : "owned-other"
      );
    }

    state.players.forEach(p=>{
      if(p.position === i){
        const tok = document.createElement("div");
        tok.className = "token";
        tok.innerText = p.name[0];
        div.appendChild(tok);
      }
    });

    boardDiv.appendChild(div);
  });

  if(state.awaitingBuy && state.awaitingBuy.playerId === socket.id){
    const tile = state.board[state.awaitingBuy.tileIndex];
    buyArea.innerHTML =
      `<button onclick="buy()">Buy ${tile.name} (‚Çπ${tile.price})</button>`;
  }

  playersDiv.innerHTML = "";
  state.players.forEach(p=>{
    playersDiv.innerHTML += `
      <div class="playerBox">
        <span class="${p.id===socket.id?'you':''}">
          ${p.name} ${p.id===socket.id?'(YOU)':''}
        </span><br>
        üí∞ ‚Çπ${p.money} | üìç ${p.position+1}
      </div>`;
  });
});
</script>

</body>
</html>
