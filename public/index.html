<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Delhi Monopoly</title>
<script src="/socket.io/socket.io.js"></script>

<style>
body {
  font-family: Arial;
  background: #f2f2f2;
  padding: 10px;
}

#board {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 8px;
}

.tile {
  background: #fff;
  border-radius: 8px;
  padding: 6px;
  min-height: 80px;
  position: relative;
}

.token {
  position: absolute;
  bottom: 4px;
  right: 4px;
  width: 16px;
  height: 16px;
  border-radius: 50%;
  background: #000;
  color: #fff;
  font-size: 11px;
  display: flex;
  align-items: center;
  justify-content: center;
}

#buyModal {
  display: none;
  position: fixed;
  bottom: 10px;
  left: 10px;
  background: #fff;
  border: 2px solid #333;
  padding: 10px;
}
</style>
</head>

<body>

<h2>Delhi Monopoly (Restored)</h2>

<input id="name" placeholder="Name">
<button onclick="join()">Join</button>
<button onclick="roll()">ðŸŽ² Roll</button>

<p id="msg"></p>

<div id="board"></div>
<div id="players"></div>

<div id="buyModal">
  <button onclick="buy()">Buy</button>
  <button onclick="skip()">Skip</button>
</div>

<script>
const socket = io();

function join() {
  socket.emit("join", document.getElementById("name").value);
}

function roll() {
  socket.emit("roll");
}

function buy() {
  socket.emit("buy");
}

function skip() {
  socket.emit("skipBuy");
}

socket.on("state", s => {
  const boardDiv = document.getElementById("board");
  const playersDiv = document.getElementById("players");
  const msg = document.getElementById("msg");
  const buyModal = document.getElementById("buyModal");

  boardDiv.innerHTML = "";
  playersDiv.innerHTML = "";
  msg.innerText = s.message || "";
  buyModal.style.display = "none";

  s.board.forEach((tile, i) => {
    const d = document.createElement("div");
    d.className = "tile";
    d.innerHTML = `<b>${tile.name}</b>${tile.price ? "<br>â‚¹" + tile.price : ""}`;

    s.players.forEach(p => {
      if (p.position === i) {
        const t = document.createElement("div");
        t.className = "token";
        t.innerText = p.name[0];
        d.appendChild(t);
      }
    });

    boardDiv.appendChild(d);
  });

  if (s.awaitingBuy && s.awaitingBuy.playerId === socket.id) {
    buyModal.style.display = "block";
  }

  s.players.forEach(p => {
    playersDiv.innerHTML += `${p.name} â€” â‚¹${p.money} â€” ðŸŽ² ${p.lastDice}<br>`;
  });
});
</script>

</body>
</html>
