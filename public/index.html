<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width">
<title>Delhi Monopoly</title>
<script src="/socket.io/socket.io.js"></script>

<style>
body{font-family:Arial;background:#f4f4f4;padding:10px}
#board{display:grid;grid-template-columns:repeat(4,1fr);gap:8px}
.tile{background:#fff;border-radius:8px;padding:6px;position:relative;min-height:90px}
.color{height:6px;border-radius:6px 6px 0 0}
.owner{position:absolute;top:6px;right:6px;background:#000;color:#fff;border-radius:50%;width:20px;height:20px;text-align:center;font-size:12px}
.tokens{position:absolute;bottom:4px;left:4px;display:flex;gap:4px}
.token{width:16px;height:16px;border-radius:50%;background:#333;color:#fff;font-size:10px;display:flex;align-items:center;justify-content:center}
.house{font-size:12px;color:green}
.playerBox{background:#fff;padding:6px;margin:6px 0;border-radius:8px}

#buyModal{
  display:none;
  position:fixed;
  top:50%;left:50%;
  transform:translate(-50%,-50%);
  background:#fff;padding:15px;
  border:2px solid #333;border-radius:10px;
}
</style>
</head>

<body>

<h2>Delhi Monopoly</h2>

<input id="name" placeholder="Name">
<button onclick="join()">Join</button>
<button onclick="roll()">üé≤ Roll</button>

<h3 id="turn">Waiting‚Ä¶</h3>

<div id="board"></div>
<div id="players"></div>

<div id="buyModal">
  <p id="buyText"></p>
  <button onclick="buy()">Buy</button>
</div>

<script>
const socket = io(window.location.origin);
let state = null;
let myId = null;

socket.on("connect", () => { myId = socket.id; });

function join(){
  const n = name.value.trim();
  if(!n) return alert("Enter name");
  socket.emit("join", n);
}

function roll(){ socket.emit("roll"); }
function buy(){ socket.emit("buy"); }

socket.on("state", s => {
  state = s;
  render();
});

function render(){
  if(!state || state.players.length === 0){
    turn.innerText = "Waiting for players‚Ä¶";
    board.innerHTML = "";
    players.innerHTML = "";
    buyModal.style.display = "none";
    return;
  }

  const current = state.players[state.turn];
  turn.innerText = current ? current.name + "'s turn" : "Waiting‚Ä¶";

  board.innerHTML = "";
  state.board.forEach((t,i)=>{
    const d=document.createElement("div");
    d.className="tile";

    if(t.color){
      const c=document.createElement("div");
      c.className="color";
      c.style.background=t.color;
      d.appendChild(c);
    }

    d.innerHTML+=`<b>${t.name}</b><br>${t.price?"‚Çπ"+t.price:""}`;

    if(t.owner){
      const o=document.createElement("div");
      o.className="owner";
      const p=state.players.find(x=>x.id===t.owner);
      o.innerText=p?p.name[0]:"?";
      d.appendChild(o);
    }

    if(t.houses>0){
      const h=document.createElement("div");
      h.className="house";
      h.innerText="üè†".repeat(t.houses);
      d.appendChild(h);
    }

    const tokBox=document.createElement("div");
    tokBox.className="tokens";
    state.players.forEach(p=>{
      if(p.pos===i){
        const tok=document.createElement("div");
        tok.className="token";
        tok.innerText=p.name[0];
        tokBox.appendChild(tok);
      }
    });
    d.appendChild(tokBox);

    if(t.owner===myId && t.color){
      const same=state.board.filter(b=>b.color===t.color);
      if(same.every(b=>b.owner===myId)){
        const btn=document.createElement("button");
        btn.innerText="Build House";
        btn.onclick=()=>socket.emit("buildHouse",i);
        d.appendChild(btn);
      }
    }

    board.appendChild(d);
  });

  players.innerHTML="";
  state.players.forEach((p,idx)=>{
    const box=document.createElement("div");
    box.className="playerBox";
    box.innerHTML=`<b>${p.name}</b><br>‚Çπ${p.money} ${idx===state.turn?"‚û°Ô∏è":""}`;
    players.appendChild(box);
  });

  if(state.awaitingBuy && state.awaitingBuy.playerId===myId){
    const tile=state.board[state.awaitingBuy.tileIndex];
    buyText.innerHTML=`Buy <b>${tile.name}</b> for ‚Çπ${tile.price}?`;
    buyModal.style.display="block";
  }else{
    buyModal.style.display="none";
  }
}
</script>

</body>
</html>
