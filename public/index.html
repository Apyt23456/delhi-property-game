<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Delhi Monopoly</title>
<script src="/socket.io/socket.io.js"></script>

<style>
body{font-family:Arial;background:#f2f2f2;padding:10px}
#board{display:grid;grid-template-columns:repeat(4,1fr);gap:8px}
.tile{background:#fff;border-radius:8px;padding:6px;min-height:80px;position:relative}
.token{width:16px;height:16px;border-radius:50%;background:#000;color:#fff;
font-size:11px;display:flex;align-items:center;justify-content:center;
position:absolute;bottom:4px;right:4px}
#buyModal{display:none;background:#fff;border:2px solid #333;padding:10px}
</style>
</head>

<body>

<h2>Delhi Monopoly (Core Restored)</h2>

<input id="name" placeholder="Name">
<button onclick="join()">Join</button>
<button onclick="roll()">Roll</button>

<div id="msg"></div>
<div id="board"></div>
<div id="players"></div>

<div id="buyModal">
  <button onclick="buy()">Buy</button>
  <button onclick="skip()">Skip</button>
</div>

<script>
const socket = io();

function join(){ socket.emit("join", name.value); }
function roll(){ socket.emit("roll"); }
function buy(){ socket.emit("buy"); }
function skip(){ socket.emit("skipBuy"); }

socket.on("state", s => {
  board.innerHTML = "";
  players.innerHTML = "";
  msg.innerText = s.message || "";
  buyModal.style.display = "none";

  s.board.forEach((t,i)=>{
    const d=document.createElement("div");
    d.className="tile";
    d.innerHTML = `<b>${t.name}</b>${t.price?`<br>â‚¹${t.price}`:""}`;

    s.players.forEach(p=>{
      if(p.position===i){
        const tok=document.createElement("div");
        tok.className="token";
        tok.innerText=p.name[0];
        d.appendChild(tok);
      }
    });

    board.appendChild(d);
  });

  if(s.awaitingBuy && s.awaitingBuy.playerId === socket.id){
    buyModal.style.display = "block";
  }

  s.players.forEach(p=>{
    players.innerHTML += `${p.name}: â‚¹${p.money} | ðŸŽ² ${p.lastDice}<br>`;
  });
});
</script>

</body>
</html>
