<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Delhi Monopoly</title>
<script src="/socket.io/socket.io.js"></script>

<style>
body{font-family:Arial;background:#f2f2f2;padding:10px}
#board{display:grid;grid-template-columns:repeat(4,1fr);gap:10px}
.tile{background:#fff;border-radius:10px;padding:8px;position:relative}
.color{height:6px;border-radius:6px 6px 0 0}
.owner{position:absolute;top:5px;right:5px;background:#000;color:#fff;border-radius:50%;width:22px;height:22px;text-align:center;font-size:12px}
.house{font-size:14px}
#popup{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);
background:#fff;padding:20px;border:2px solid #333;border-radius:10px;display:none}
</style>
</head>

<body>
<h1>Delhi Monopoly</h1>

<input id="name" placeholder="Name">
<button onclick="join()">Join</button>
<button onclick="roll()">üé≤ Roll</button>

<h3 id="turn"></h3>

<div id="board"></div>

<div id="popup">
  <p id="popupText"></p>
  <button onclick="buy()">Buy</button>
  <button onclick="skip()">Skip</button>
</div>

<script>
const socket = io();
let state;

function join(){ socket.emit("join", name.value); }
function roll(){ socket.emit("roll"); }
function buy(){ socket.emit("buy"); closePopup(); }
function skip(){ socket.emit("skipBuy"); closePopup(); }

function closePopup(){ popup.style.display="none"; }

socket.on("state", s=>{
  state=s;
  render();
});

function render(){
  if(!state) return;

  turn.innerText = state.players[state.turn]?.name+"'s turn";

  board.innerHTML="";
  state.board.forEach((t,i)=>{
    const d=document.createElement("div");
    d.className="tile";
    if(t.color){
      const c=document.createElement("div");
      c.className="color";
      c.style.background=t.color;
      d.appendChild(c);
    }
    d.innerHTML+=`<b>${t.name}</b><br>${t.price?"‚Çπ"+t.price:""}`;

    if(t.owner){
      const o=document.createElement("div");
      o.className="owner";
      o.innerText=state.players.find(p=>p.id===t.owner)?.name[0];
      d.appendChild(o);
    }

    if(t.houses){
      d.innerHTML+=`<div class="house">${"üè†".repeat(t.houses)}</div>`;
    }

    board.appendChild(d);
  });

  if(state.awaitingBuy){
    popup.style.display="block";
    popupText.innerText="Buy this property?";
  }
}
</script>
</body>
</html>
