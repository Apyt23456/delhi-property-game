<!DOCTYPE html>
<html>
<head>
  <title>Delhi Property Game</title>
  <script src="/socket.io/socket.io.js"></script>

  <style>
    body { font-family: Arial; background:#f2f2f2; padding:10px }
    h2 { text-align:center }
    #board { display:grid; grid-template-columns:repeat(4,1fr); gap:8px }
    .tile { background:#fff; padding:6px; border-radius:8px; min-height:90px }
    .owned { border:3px solid #2ecc71 }
    .player { background:#fff; padding:6px; margin:5px 0; border-radius:6px }
    #popup {
      position:fixed; inset:0;
      background:rgba(0,0,0,.5);
      display:none;
    }
    #popupBox {
      background:#fff;
      padding:15px;
      width:80%;
      margin:30% auto;
      border-radius:8px;
      text-align:center;
    }
  </style>
</head>

<body>

<h2>Delhi Property Game</h2>

<input id="playerName" placeholder="Name">
<button onclick="join()">Join</button>
<button onclick="roll()">üé≤ Roll</button>

<div id="msg"></div>
<div id="board"></div>
<div id="players"></div>

<div id="popup">
  <div id="popupBox">
    <div id="popupText"></div><br>
    <button onclick="buy()">Buy</button>
    <button onclick="skip()">Skip</button>
  </div>
</div>

<script>
const socket = io();
let myId = null;

const nameInput = document.getElementById("playerName");
const board = document.getElementById("board");
const players = document.getElementById("players");
const msg = document.getElementById("msg");
const popup = document.getElementById("popup");
const popupText = document.getElementById("popupText");

socket.on("connect", () => {
  myId = socket.id;
});

function join(){
  const playerName = nameInput.value.trim();
  if (!playerName) {
    alert("Please enter your name");
    return;
  }
  socket.emit("join", playerName);
}

function roll(){ socket.emit("roll"); }
function buy(){ socket.emit("buy"); }
function skip(){ socket.emit("skip"); }

socket.on("update", g => {
  msg.innerText = g.message || "";

  // BOARD
  board.innerHTML = "";
  g.board.forEach(t => {
    board.innerHTML += `
      <div class="tile ${t.owner ? "owned":""}">
        <b>${t.name}</b><br>
        ${t.price ? "‚Çπ"+t.price : ""}
      </div>`;
  });

  // PLAYERS
  players.innerHTML = "<h3>Players</h3>";
  g.players.forEach((p,i)=>{
    players.innerHTML += `
      <div class="player">
        ${p.name} | ‚Çπ${p.money} | Pos ${p.position}
        ${i===g.turnIndex?" ‚Üê Turn":""}
      </div>`;
  });

  // BUY POPUP
  if (g.awaitingBuy === myId) {
    const me = g.players[g.turnIndex];
    const tile = g.board[me.position - 1];
    popupText.innerText = `Buy ${tile.name} for ‚Çπ${tile.price}?`;
    popup.style.display = "block";
  } else {
    popup.style.display = "none";
  }
});
</script>

</body>
</html>
